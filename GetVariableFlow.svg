<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1417px" preserveAspectRatio="none" style="width:665px;height:1417px;" version="1.1" viewBox="0 0 665 1417" width="665px" zoomAndPan="magnify"><defs><filter height="300%" id="f460xk3g2eu52" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="416.5" y="882.2813"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="613.5" y="813.5781"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="522.8594" style="stroke:#000000;stroke-width:2.0;" width="638" x="10" y="133.3125"/><rect fill="#FFFFFF" height="71.1875" style="stroke:none;stroke-width:1.0;" width="638" x="10" y="176.6641"/><rect fill="#FFFFFF" height="408.3203" style="stroke:none;stroke-width:1.0;" width="638" x="10" y="247.8516"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="304.7813" style="stroke:#000000;stroke-width:2.0;" width="348" x="20" y="344.3906"/><rect fill="#FFFFFF" height="146.8906" style="stroke:none;stroke-width:1.0;" width="348" x="20" y="387.7422"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="205" x="153" y="410.5781"/><rect fill="#FFFFFF" height="114.5391" style="stroke:none;stroke-width:1.0;" width="348" x="20" y="534.6328"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="358.4844" style="stroke:#000000;stroke-width:2.0;" width="638" x="10" y="772.875"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="192.0781" style="stroke:#000000;stroke-width:2.0;" width="569.5" x="20" y="932.2813"/><rect fill="#FFFFFF" height="59.1875" style="stroke:none;stroke-width:1.0;" width="569.5" x="20" y="975.6328"/><rect fill="#FFFFFF" height="89.5391" style="stroke:none;stroke-width:1.0;" width="569.5" x="20" y="1034.8203"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="225.5" x="315" y="1263.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="54" y1="41.6094" y2="663.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="54" x2="54" y1="663.1719" y2="691.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="54" y1="691.1719" y2="1138.3594"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="54" x2="54" y1="1138.3594" y2="1166.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="54" y1="1166.3594" y2="1372.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="239" x2="239" y1="41.6094" y2="663.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="239" x2="239" y1="663.1719" y2="691.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="239" x2="239" y1="691.1719" y2="1138.3594"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="239" x2="239" y1="1138.3594" y2="1166.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="239" x2="239" y1="1166.3594" y2="1372.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="421" x2="421" y1="41.6094" y2="663.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="421" x2="421" y1="663.1719" y2="691.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="421" x2="421" y1="691.1719" y2="1138.3594"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="421" x2="421" y1="1138.3594" y2="1166.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="421" x2="421" y1="1166.3594" y2="1372.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="618" x2="618" y1="41.6094" y2="663.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="618" x2="618" y1="663.1719" y2="691.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="618" x2="618" y1="691.1719" y2="1138.3594"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="618" x2="618" y1="1138.3594" y2="1166.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="618" x2="618" y1="1166.3594" y2="1372.4688"/><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="44" x="30" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="37" y="26.5332">UEFI</text><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="44" x="30" y="1371.4688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="37" y="1393.002">UEFI</text><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="148" x="163" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="170" y="26.5332">VariablePei(PreMem)</text><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="148" x="163" y="1371.4688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="170" y="1393.002">VariablePei(PreMem)</text><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="189" x="325" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="332" y="26.5332">VariablePei(PostMem)/SMM</text><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="189" x="325" y="1371.4688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="175" x="332" y="1393.002">VariablePei(PostMem)/SMM</text><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="35" x="599" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="606" y="26.5332">SPI</text><rect fill="#FEFECE" filter="url(#f460xk3g2eu52)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="35" x="599" y="1371.4688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="606" y="1393.002">SPI</text><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="416.5" y="882.2813"/><rect fill="#FFFFFF" filter="url(#f460xk3g2eu52)" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="613.5" y="813.5781"/><rect fill="#EEEEEE" filter="url(#f460xk3g2eu52)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="658" x="0" y="72.7852"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="658" y1="72.7852" y2="72.7852"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="658" y1="75.7852" y2="75.7852"/><rect fill="#EEEEEE" filter="url(#f460xk3g2eu52)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="91" x="283.5" y="61.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="289.5" y="79.1045">Pre-Memory</text><polygon fill="#A80036" points="227,114.3125,237,118.3125,227,122.3125,231,118.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="233" y1="118.3125" y2="118.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="61" y="113.4561">GetVariable()</text><path d="M10,133.3125 L71,133.3125 L71,141.3125 L61,151.3125 L10,151.3125 L10,133.3125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="522.8594" style="stroke:#000000;stroke-width:2.0;" width="638" x="10" y="133.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="25" y="147.8076">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162" x="86" y="146.7314">[Check variable storage type]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="648" y1="177.6641" y2="177.6641"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="76" x="15" y="189.083">[HOB variable]</text><polygon fill="#A80036" points="65,210.8516,55,214.8516,65,218.8516,61,214.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="238" y1="214.8516" y2="214.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="71" y="209.9951">Return data with SUCCESS</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="648" y1="248.8516" y2="248.8516"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="69" x="15" y="260.2705">[NV variable]</text><polygon fill="#A80036" points="250,282.0391,240,286.0391,250,290.0391,246,286.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="244" x2="617.5" y1="286.0391" y2="286.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="256" y="281.1826">Requested variable</text><line style="stroke:#A80036;stroke-width:1.0;" x1="239" x2="281" y1="316.3906" y2="316.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="281" x2="281" y1="316.3906" y2="329.3906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240" x2="281" y1="329.3906" y2="329.3906"/><polygon fill="#A80036" points="250,325.3906,240,329.3906,250,333.3906,246,329.3906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="246" y="311.5342">Calculate HASH(variable)</text><path d="M20,344.3906 L81,344.3906 L81,352.3906 L71,362.3906 L20,362.3906 L20,344.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="304.7813" style="stroke:#000000;stroke-width:2.0;" width="348" x="20" y="344.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="35" y="358.8857">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="96" y="357.8096">[Check HASH(variable) against cached value]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="368" y1="388.7422" y2="388.7422"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="25" y="400.1611">[Hash value match]</text><path d="M153,410.5781 L218,410.5781 L218,418.5781 L208,428.5781 L153,428.5781 L153,410.5781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="205" x="153" y="410.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="168" y="425.0732">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74" x="233" y="423.9971">[if encrypted]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="239" x2="281" y1="451.2813" y2="451.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="281" x2="281" y1="451.2813" y2="464.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240" x2="281" y1="464.2813" y2="464.2813"/><polygon fill="#A80036" points="250,460.2813,240,464.2813,250,468.2813,246,464.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="246" y="446.4248">DecryptVariable()</text><polygon fill="#A80036" points="65,497.6328,55,501.6328,65,505.6328,61,501.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="238" y1="501.6328" y2="501.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="71" y="496.7764">Return data with SUCCESS</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="368" y1="535.6328" y2="535.6328"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="25" y="547.0518">[Hash value mismatch]</text><polygon fill="#A80036" points="65,568.8203,55,572.8203,65,576.8203,61,572.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="59" x2="238" y1="572.8203" y2="572.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="71" y="567.9639">ReportStatusCode(FAIL)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="239" x2="281" y1="603.1719" y2="603.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="281" x2="281" y1="603.1719" y2="616.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="240" x2="281" y1="616.1719" y2="616.1719"/><polygon fill="#A80036" points="250,612.1719,240,616.1719,250,620.1719,246,616.1719" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="246" y="598.3154">CpuDeadLoop()</text><rect fill="#EEEEEE" filter="url(#f460xk3g2eu52)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="658" x="0" y="712.3477"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="658" y1="712.3477" y2="712.3477"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="658" y1="715.3477" y2="715.3477"/><rect fill="#EEEEEE" filter="url(#f460xk3g2eu52)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="96" x="281" y="701.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="287" y="718.667">Post-Memory</text><polygon fill="#A80036" points="409.5,753.875,419.5,757.875,409.5,761.875,413.5,757.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="415.5" y1="757.875" y2="757.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="261" x="61" y="753.0186">NotifyPpi (gEfiPeiMemoryDiscoveredPpiGuid)</text><path d="M10,772.875 L296,772.875 L296,780.875 L286,790.875 L10,790.875 L10,772.875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="358.4844" style="stroke:#000000;stroke-width:2.0;" width="638" x="10" y="772.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="25" y="787.3701">MemoryDiscoveredPpiNotifyCallback()</text><polygon fill="#A80036" points="601.5,809.5781,611.5,813.5781,601.5,817.5781,605.5,813.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="421.5" x2="607.5" y1="813.5781" y2="813.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="428.5" y="808.7217">Get all variables</text><polygon fill="#A80036" points="432.5,839.9297,422.5,843.9297,432.5,847.9297,428.5,843.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="426.5" x2="617.5" y1="843.9297" y2="843.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="438.5" y="839.0732">All variables data</text><line style="stroke:#A80036;stroke-width:1.0;" x1="426.5" x2="468.5" y1="874.2813" y2="874.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="468.5" x2="468.5" y1="874.2813" y2="887.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="427.5" x2="468.5" y1="887.2813" y2="887.2813"/><polygon fill="#A80036" points="437.5,883.2813,427.5,887.2813,437.5,891.2813,433.5,887.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="433.5" y="869.4248">Calculate hash for each variable</text><path d="M20,932.2813 L81,932.2813 L81,940.2813 L71,950.2813 L20,950.2813 L20,932.2813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="192.0781" style="stroke:#000000;stroke-width:2.0;" width="569.5" x="20" y="932.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="35" y="946.7764">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="277" x="96" y="945.7002">[Verify hash of each variable against cached value]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="589.5" y1="976.6328" y2="976.6328"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="25" y="988.0518">[Hash value match]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="421.5" x2="463.5" y1="1013.8203" y2="1013.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="463.5" x2="463.5" y1="1013.8203" y2="1026.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="463.5" y1="1026.8203" y2="1026.8203"/><polygon fill="#A80036" points="432.5,1022.8203,422.5,1026.8203,432.5,1030.8203,428.5,1026.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="428.5" y="1008.9639">Cache variable in memory</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="589.5" y1="1035.8203" y2="1035.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="25" y="1047.2393">[Hash value mismatch]</text><polygon fill="#A80036" points="65,1069.0078,55,1073.0078,65,1077.0078,61,1073.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="420.5" y1="1073.0078" y2="1073.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="71" y="1068.1514">ReportStatusCode(FAIL)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="421.5" x2="463.5" y1="1103.3594" y2="1103.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="463.5" x2="463.5" y1="1103.3594" y2="1116.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="463.5" y1="1116.3594" y2="1116.3594"/><polygon fill="#A80036" points="432.5,1112.3594,422.5,1116.3594,432.5,1120.3594,428.5,1116.3594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="428.5" y="1098.5029">CpuDeadLoop()</text><polygon fill="#A80036" points="409.5,1184.7109,419.5,1188.7109,409.5,1192.7109,413.5,1188.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="415.5" y1="1188.7109" y2="1188.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="61" y="1183.8545">GetVariable()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="421.5" x2="463.5" y1="1235.4141" y2="1235.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="463.5" x2="463.5" y1="1235.4141" y2="1248.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="463.5" y1="1248.4141" y2="1248.4141"/><polygon fill="#A80036" points="432.5,1244.4141,422.5,1248.4141,432.5,1252.4141,428.5,1248.4141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="428.5" y="1214.2061">Get requested variable</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="428.5" y="1230.5576">from cache</text><path d="M315,1263.4141 L380,1263.4141 L380,1271.4141 L370,1281.4141 L315,1281.4141 L315,1263.4141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.7031" style="stroke:#000000;stroke-width:2.0;" width="225.5" x="315" y="1263.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="20" x="330" y="1277.9092">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="395" y="1276.833">[Encrypted]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="421.5" x2="463.5" y1="1304.1172" y2="1304.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="463.5" x2="463.5" y1="1304.1172" y2="1317.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="463.5" y1="1317.1172" y2="1317.1172"/><polygon fill="#A80036" points="432.5,1313.1172,422.5,1317.1172,432.5,1321.1172,428.5,1317.1172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="428.5" y="1299.2607">DecryptVariable()</text><polygon fill="#A80036" points="65,1350.4688,55,1354.4688,65,1358.4688,61,1354.4688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="59" x2="420.5" y1="1354.4688" y2="1354.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="71" y="1349.6123">Return data</text><!--MD5=[67700ad6e39ed1e91fa99977e0049e9d]
@startuml GetVariable Flow

participant UEFI
participant "VariablePei(PreMem)" as PreMem
participant "VariablePei(PostMem)/SMM" as PostMem
participant SPI

  ==Pre-Memory==
  UEFI -> PreMem : GetVariable()

  alt Check variable storage type
    |||
  else HOB variable
    PreMem -> UEFI: Return data with SUCCESS
    |||
  else NV variable
    PreMem <- SPI: Requested variable
    PreMem -> PreMem: Calculate HASH(variable)

    alt Check HASH(variable) against cached value
      |||
    else Hash value match
      opt if encrypted
        PreMem -> PreMem : DecryptVariable()
      end
      PreMem -> UEFI: Return data with SUCCESS
      |||
    else Hash value mismatch
      PreMem - -> UEFI: ReportStatusCode(FAIL)
      PreMem -> PreMem: CpuDeadLoop()
      |||
    end
  end

  ...

  ==Post-Memory==
  UEFI - -> PostMem: NotifyPpi (gEfiPeiMemoryDiscoveredPpiGuid)
  group MemoryDiscoveredPpiNotifyCallback()
    PostMem -> SPI ++: Get all variables
    SPI -> PostMem - -: All variables data

    PostMem -> PostMem ++: Calculate hash for each variable
    deactivate PostMem

    alt Verify hash of each variable against cached value
      |||
    else Hash value match
      PostMem -> PostMem: Cache variable in memory
    else Hash value mismatch
      PostMem -> UEFI: ReportStatusCode(FAIL)
      PostMem -> PostMem: CpuDeadLoop()
    end

  end

  ...
  UEFI -> PostMem : GetVariable()
  PostMem -> PostMem : Get requested variable\nfrom cache

  opt Encrypted
    PostMem -> PostMem : DecryptVariable()
  end

  PostMem - -> UEFI : Return data

@enduml

PlantUML version 1.2020.26(Tue Dec 22 01:45:07 CST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>